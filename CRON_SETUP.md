# Настройка CRON для автоматизации РСЯ

## Необходимо настроить 2 крон-задачи на хостинге:

### 1. Worker для обработки очереди блокировки (каждую минуту)
```bash
* * * * * wget -O /dev/null -t 1 -q 'https://functions.poehali.dev/eec1c17a-e079-4e13-983b-12132a3888fd'
```

### 2. Автоматизация проверки задач (каждую минуту)
```bash
* * * * * wget -O /dev/null -t 1 -q 'https://functions.poehali.dev/d26aaae5-ffb1-46ce-bc94-e692335fdfda'
```

## Как работает система:

1. **rsya-automation** (каждую минуту):
   - Проверяет все активные задачи пользователей
   - Если пришло время выполнения (по schedule_interval)
   - Получает площадки из Яндекс.Директа
   - Фильтрует по критериям задачи
   - Добавляет подходящие площадки в очередь блокировки (таблица block_queue)

2. **rsya-block-worker** (каждую минуту):
   - Берет до 100 площадок из очереди блокировки
   - Группирует по кампаниям
   - Блокирует пачками через Yandex Direct API
   - Обновляет статусы в БД

## Производительность:
- До 6,000 площадок в минуту (100 площадок × 60 секунд)
- До 144,000 площадок в сутки
- Обработка по кампаниям (1 запрос на всю кампанию)

## Мониторинг:
Проверить работу можно в таблицах:
- `block_queue` - текущая очередь блокировки
- `task_processing_status` - статистика по задачам
- `task_history` - история выполнения задач
