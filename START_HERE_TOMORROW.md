# üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ü–£–°–ö–ê –ú–ò–ì–†–ê–¶–ò–ò

## üìå –ß—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å:

1. **CHECK_DATABASE_STRUCTURE.sql** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
2. **MIGRATION_FULL.sql** - –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü)

---

## üîß –®–ê–ì 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –£–∑–Ω–∞–π —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL:
```bash
# –û–±—ã—á–Ω–æ —ç—Ç–æ:
# HOST: localhost –∏–ª–∏ IP —Å–µ—Ä–≤–µ—Ä–∞
# PORT: 5432 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
# USER: —Ç–≤–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PostgreSQL
# DATABASE: t_p97630513_yandex_cleaning_serv
```

---

## üìä –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ psql (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)
```bash
psql -h YOUR_HOST -p 5432 -U YOUR_USER -d t_p97630513_yandex_cleaning_serv -f CHECK_DATABASE_STRUCTURE.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ DBeaver/pgAdmin/–¥—Ä—É–≥–æ–π SQL –∫–ª–∏–µ–Ω—Ç
1. –û—Ç–∫—Ä–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
2. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª **CHECK_DATABASE_STRUCTURE.sql**
3. –í—ã–ø–æ–ª–Ω–∏ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç (–æ–±—ã—á–Ω–æ F5 –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "Execute")
4. –ü–æ—Å–º–æ—Ç—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã - —É–≤–∏–¥–∏—à—å —á—Ç–æ –µ—Å—Ç—å, —á–µ–≥–æ –Ω–µ—Ç

---

## üöÄ –®–ê–ì 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–¥–µ–ª–∞–π –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)

#### –ë—ç–∫–∞–ø –±–∞–∑—ã:
```bash
# –°–¥–µ–ª–∞–π –¥–∞–º–ø –±–∞–∑—ã –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
pg_dump -h YOUR_HOST -p 5432 -U YOUR_USER -d t_p97630513_yandex_cleaning_serv > backup_before_migration_$(date +%Y%m%d_%H%M%S).sql
```

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ psql
```bash
psql -h YOUR_HOST -p 5432 -U YOUR_USER -d t_p97630513_yandex_cleaning_serv -f MIGRATION_FULL.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ DBeaver/pgAdmin
1. –û—Ç–∫—Ä–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
2. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª **MIGRATION_FULL.sql**
3. –í—ã–ø–æ–ª–Ω–∏ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç (F5 –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "Execute")
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–ª–∏—Å—å

---

## ‚úÖ –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã:
```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = CURRENT_SCHEMA()
  AND table_name IN (
    'partners',
    'referrals', 
    'referral_clicks',
    'partner_payouts',
    'rsya_queue_snapshots',
    'rsya_blocking_logs'
  )
ORDER BY table_name;
```

### –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 6 —Ç–∞–±–ª–∏—Ü:
- ‚úÖ partner_payouts
- ‚úÖ partners
- ‚úÖ referral_clicks
- ‚úÖ referrals
- ‚úÖ rsya_blocking_logs
- ‚úÖ rsya_queue_snapshots

---

## üéØ –ë–´–°–¢–†–´–ô –í–ê–†–ò–ê–ù–¢ (–µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å—Ä–∞–∑—É –≤—Å—ë –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ + –º–∏–≥—Ä–∞—Ü–∏—è):

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞
echo "=== –ü–†–û–í–ï–†–ö–ê –ë–ê–ó–´ ==="
psql -h YOUR_HOST -p 5432 -U YOUR_USER -d t_p97630513_yandex_cleaning_serv -f CHECK_DATABASE_STRUCTURE.sql

# 2. –ñ–¥—ë–º 3 —Å–µ–∫—É–Ω–¥—ã —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
sleep 3

# 3. –ú–∏–≥—Ä–∞—Ü–∏—è
echo "=== –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ú–ò–ì–†–ê–¶–ò–ò ==="
psql -h YOUR_HOST -p 5432 -U YOUR_USER -d t_p97630513_yandex_cleaning_serv -f MIGRATION_FULL.sql

echo "=== –ì–û–¢–û–í–û! ==="
```

–°–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ –≤ —Ñ–∞–π–ª `run_migration.sh` –∏ –∑–∞–ø—É—Å—Ç–∏:
```bash
chmod +x run_migration.sh
./run_migration.sh
```

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (—É–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã):
```sql
DROP TABLE IF EXISTS referral_clicks CASCADE;
DROP TABLE IF EXISTS partner_payouts CASCADE;
DROP TABLE IF EXISTS referrals CASCADE;
DROP TABLE IF EXISTS partners CASCADE;
DROP TABLE IF EXISTS rsya_blocking_logs CASCADE;
DROP TABLE IF EXISTS rsya_queue_snapshots CASCADE;
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞:
```bash
psql -h YOUR_HOST -p 5432 -U YOUR_USER -d t_p97630513_yandex_cleaning_serv < backup_before_migration_YYYYMMDD_HHMMSS.sql
```

---

## üìù –ß–¢–û –ë–£–î–ï–¢ –°–û–ó–î–ê–ù–û

### –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (4 —Ç–∞–±–ª–∏—Ü—ã):
1. **partners** - –ø–∞—Ä—Ç–Ω–µ—Ä—ã —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏
2. **referrals** - —Å–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∏ –∫–æ–º–∏—Å—Å–∏–∏  
3. **referral_clicks** - –∫–ª–∏–∫–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º —Å—Å—ã–ª–∫–∞–º
4. **partner_payouts** - –≤—ã–ø–ª–∞—Ç—ã –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º

### RSYA –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (2 —Ç–∞–±–ª–∏—Ü—ã):
1. **rsya_queue_snapshots** - —Å–Ω–∞–ø—à–æ—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
2. **rsya_blocking_logs** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø–ª–æ—â–∞–¥–æ–∫

---

## üí° –ó–ê–ú–ï–¢–ö–ò

- –ú–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS` - –Ω–µ –∑–∞—Ç—Ä—ë—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–∂–µ —Å `IF NOT EXISTS` - –Ω–µ —Å–æ–∑–¥–∞—Å—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ –µ—Å—Ç—å - –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –µ—ë
- –í –∫–æ–Ω—Ü–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç SELECT —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

---

## üéâ –ü–û–°–õ–ï –£–°–ü–ï–®–ù–û–ô –ú–ò–ì–†–ê–¶–ò–ò

–ú–æ–∂–µ—à—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã:
- CHECK_DATABASE_STRUCTURE.sql
- MIGRATION_FULL.sql  
- START_HERE_TOMORROW.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- run_migration.sh (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–≤–∞–ª)

–ù–æ –±—ç–∫–∞–ø –æ—Å—Ç–∞–≤—å –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –Ω–∞ –Ω–µ–¥–µ–ª—å–∫—É!

---

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞! üåô**
**–ó–∞–≤—Ç—Ä–∞ –≤—Å—ë –ø—Ä–æ–π–¥—ë—Ç –≥–ª–∞–¥–∫–æ üöÄ**
